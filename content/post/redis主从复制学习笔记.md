+++
date = "2016-02-26T16:15:31+08:00"
draft = false
title = "redis主从复制学习笔记"

+++

* redis[主从复制](http://qifuguang.me/2015/10/18/Redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/)
    * 在介绍REDIS的RDB持久化方式时，我们提到了主从复制的实现过程
        * 第一次同步，slave发送sync命令开始同步，master生成快照全量发送给slave，快照生成之后的变更命令缓存起来，也一块发送给slave
        * 第二次及以后的同步，master收到命令后修改数据，并将数据修改后的结果同步给slave；如果此时发生断开重连情况，则重新进行第一步操作；
        * redis-2.8版本后，如果发生断开重连，则进行增量传输，而不是全量传输
    * 这里有两个值得介绍的地方
        * 不论是否设置RDB持久化，主从复制都会产生快照
        * redis.conf中不设置save 900 1等配置时，只是不自动产生快照，如果执行save，还是会产生快照的
        * 主从复制时，master执行完命令后会立刻将结果返回client，而不是等待同步给slave后再返回给client。这里可能会有一个不一致窗口，如果主从在master执行完指令和同步给client之间断开，这里会发生不一致现象，需要注意
    * 主从复制的常见设计思路
        * 用于保证数据持久化
            * master正常读写，不设置RDB或者AOF的持久化
            * slave设置RDB和AOF方式持久化，保证数据安全
        * 基于实用目的的主从复制
            * master设置为只写模式，将结果同步给slave
            * slave设置为只读模式，作为系统缓存
